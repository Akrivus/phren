<%= form_with(model: prompt) do |form| %>
  <% if prompt.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(prompt.errors.count, "error") %> prohibited this prompt from being saved:</h2>

      <ul>
        <% prompt.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-3">
    <%= form.label :name %>
    <%= form.text_field :name, class: 'form-control' %>
  </div>

  <div class="mb-3">
    <%= form.label :description %>
    <%= form.text_area :description, class: 'form-control' %>
  </div>

  <div class="mb-3">
    <%= form.label :metadata %>
    <%= form.text_area :metadata, class: 'form-control' %>
  </div>

  <div class="mb-3">
    <%= form.label :model %>
    <%= form.select :model, %w[gpt-3.5-turbo gpt-4o gpt-4 gpt-4-turbo], {}, class: 'form-control' %>
  </div>

  <div class="mb-3">
    <%= form.label :max_tokens %>
    <%= form.number_field :max_tokens, class: 'form-control', in: 0..4096 %>
  </div>

  <div class="mb-3">
    <%= form.label :temperature %>
    <%= form.number_field :temperature, class: 'form-control', in: 0..1, step: 0.1  %>
  </div>

  <div class="mb-3">
    <%= form.label :voice %>
    <%= form.select :voice, %w[alloy echo fable onyx nova shimmer], {}, class: 'form-control' %>
  </div>

  <div class="mb-3">
    <%= form.label :interstitial_prompt %>
    <%= form.text_area :interstitial_prompt, class: 'form-control' %>
  </div>

  <div class="mb-3">
    <%= form.label :messages %>
    <table class="table">
      <thead>
        <tr>
          <th scope="col" style="width:15%; min-width:7rem;">Role</th>
          <th scope="col">Content</th>
          <th scope="col" style="width:3rem;"></th>
        </tr>
      </thead>
      <tbody>
        <% prompt.messages.order(created_at: :asc).each do |message| %>
          <%= form.fields_for :messages, message do |fields| %>
            <tr>
              <td><%= fields.select :role, %w[system user assistant], {}, class: 'form-control' %></td>
              <td><%= fields.text_area :content, class: 'form-control' %></td>
              <td>
                <div class="custom-control custom-checkbox">
                  <%= fields.check_box :_destroy, class: 'custom-control-input' %>
                </div>
              </td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </div>

  <div>
    <%= form.submit class: 'btn btn-lg btn-primary' %>
  </div>
<% end %>
